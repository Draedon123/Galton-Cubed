(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();class Y{samples;maxSamples;constructor(t){this.samples=[],this.maxSamples=t}get average(){return this.samples.reduce((t,e)=>t+e,0)/this.samples.length}addSample(t){this.samples.length===this.maxSamples&&this.samples.shift(),this.samples.push(t)}reset(){this.samples.splice(0,this.samples.length)}}class D{static modifiedDevices=new Set;canTimestamp;querySet;resolveBuffer;resultBuffer;rollingAverage;onUpdate;constructor(t,e=()=>{}){if(this.canTimestamp=t.features.has("timestamp-query"),this.onUpdate=e,this.rollingAverage=new Y(50),this.canTimestamp&&(this.querySet=t.createQuerySet({label:"GPUTimer Query Set",type:"timestamp",count:2}),this.resolveBuffer=t.createBuffer({label:"GPUTimer Resolve Buffer",size:this.querySet.count*BigInt64Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=t.createBuffer({label:"GPUTimer Result Buffer",size:this.resolveBuffer.size,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})),!D.modifiedDevices.has(t)){const s=t.queue.submit.bind(t.queue);t.queue.submit=n=>{s(n),!(!this.canTimestamp||this.resultBuffer.mapState!=="unmapped")&&this.resultBuffer.mapAsync(GPUMapMode.READ).then(()=>{const o=new BigInt64Array(this.resultBuffer.getMappedRange());this.rollingAverage.addSample(Number(o[1]-o[0])),this.resultBuffer.unmap(),this.onUpdate(this.rollingAverage.average)})},D.modifiedDevices.add(t)}}get time(){return this.rollingAverage.average}beginComputePass(t,e){const s={querySet:this.querySet,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1},n=t.beginComputePass({...e,...this.canTimestamp?{timestampWrites:s}:void 0}),o=n.end.bind(n);return n.end=()=>{o(),this.canTimestamp&&(t.resolveQuerySet(this.querySet,0,this.querySet.count,this.resolveBuffer,0),this.resultBuffer.mapState==="unmapped"&&t.copyBufferToBuffer(this.resolveBuffer,this.resultBuffer))},n}beginRenderPass(t,e){const s={querySet:this.querySet,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1},n=t.beginRenderPass({...e,...this.canTimestamp?{timestampWrites:s}:void 0}),o=n.end.bind(n);return n.end=()=>{o(),this.canTimestamp&&(t.resolveQuerySet(this.querySet,0,this.querySet.count,this.resolveBuffer,0),this.resultBuffer.mapState==="unmapped"&&t.copyBufferToBuffer(this.resolveBuffer,this.resultBuffer))},n}reset(){this.rollingAverage.reset()}}class A{components;constructor(){this.components=new Float32Array(16),this.components[0]=1,this.components[5]=1,this.components[10]=1,this.components[15]=1}static multiplyMatrices(t,e,s=new A){const n=t.components[0],o=t.components[1],i=t.components[2],c=t.components[3],a=t.components[4],h=t.components[5],b=t.components[6],v=t.components[7],l=t.components[8],f=t.components[9],r=t.components[10],p=t.components[11],x=t.components[12],B=t.components[13],M=t.components[14],T=t.components[15];let d=e.components[0],g=e.components[1],w=e.components[2],y=e.components[3];return s.components[0]=d*n+g*a+w*l+y*x,s.components[1]=d*o+g*h+w*f+y*B,s.components[2]=d*i+g*b+w*r+y*M,s.components[3]=d*c+g*v+w*p+y*T,d=e.components[4],g=e.components[5],w=e.components[6],y=e.components[7],s.components[4]=d*n+g*a+w*l+y*x,s.components[5]=d*o+g*h+w*f+y*B,s.components[6]=d*i+g*b+w*r+y*M,s.components[7]=d*c+g*v+w*p+y*T,d=e.components[8],g=e.components[9],w=e.components[10],y=e.components[11],s.components[8]=d*n+g*a+w*l+y*x,s.components[9]=d*o+g*h+w*f+y*B,s.components[10]=d*i+g*b+w*r+y*M,s.components[11]=d*c+g*v+w*p+y*T,d=e.components[12],g=e.components[13],w=e.components[14],y=e.components[15],s.components[12]=d*n+g*a+w*l+y*x,s.components[13]=d*o+g*h+w*f+y*B,s.components[14]=d*i+g*b+w*r+y*M,s.components[15]=d*c+g*v+w*p+y*T,s}static perspective(t,e,s,n){const o=new A,i=1/Math.tan(t/2);if(o.components[0]=i/e,o.components[5]=i,o.components[11]=-1,o.components[15]=0,n!==1/0){const c=1/(s-n);o.components[10]=n*c,o.components[14]=n*s*c}else o.components[10]=-1,o.components[14]=-s;return o}static lookAt(t,e,s){const n=new A,o=1e-6;let i,c,a,h,b,v,l,f,r,p;const x=t.x,B=t.y,M=t.z,T=s.x,d=s.y,g=s.z,w=e.x,y=e.y,S=e.z;return Math.abs(x-w)<o&&Math.abs(B-y)<o&&Math.abs(M-S)<o?(console.warn("Look At too close to Position"),new A):(l=x-w,f=B-y,r=M-S,p=1/Math.sqrt(l*l+f*f+r*r),l*=p,f*=p,r*=p,i=d*r-g*f,c=g*l-T*r,a=T*f-d*l,p=Math.sqrt(i*i+c*c+a*a),p?(p=1/p,i*=p,c*=p,a*=p):(i=0,c=0,a=0),h=f*a-r*c,b=r*i-l*a,v=l*c-f*i,p=Math.sqrt(h*h+b*b+v*v),p?(p=1/p,h*=p,b*=p,v*=p):(h=0,b=0,v=0),n.components[0]=i,n.components[1]=h,n.components[2]=l,n.components[3]=0,n.components[4]=c,n.components[5]=b,n.components[6]=f,n.components[7]=0,n.components[8]=a,n.components[9]=v,n.components[10]=r,n.components[11]=0,n.components[12]=-(i*x+c*B+a*M),n.components[13]=-(h*x+b*B+v*M),n.components[14]=-(l*x+f*B+r*M),n.components[15]=1,n)}copyFrom(t){return this.components[0]=t.components[0],this.components[1]=t.components[1],this.components[2]=t.components[2],this.components[3]=t.components[3],this.components[4]=t.components[4],this.components[5]=t.components[5],this.components[6]=t.components[6],this.components[7]=t.components[7],this.components[8]=t.components[8],this.components[9]=t.components[9],this.components[10]=t.components[10],this.components[11]=t.components[11],this.components[12]=t.components[12],this.components[13]=t.components[13],this.components[14]=t.components[14],this.components[15]=t.components[15],this}invert(){const t=this.components[0],e=this.components[1],s=this.components[2],n=this.components[3],o=this.components[4],i=this.components[5],c=this.components[6],a=this.components[7],h=this.components[8],b=this.components[9],v=this.components[10],l=this.components[11],f=this.components[12],r=this.components[13],p=this.components[14],x=this.components[15],B=t*i-e*o,M=t*c-s*o,T=t*a-n*o,d=e*c-s*i,g=e*a-n*i,w=s*a-n*c,y=h*r-b*f,S=h*p-v*f,z=h*x-l*f,C=b*p-v*r,F=b*x-l*r,R=v*x-l*p,V=B*R-M*F+T*C+d*z-g*S+w*y;if(V<1e-8)return console.warn("Determinant is too close to 0. Matrix not inverted"),this;const E=1/V;return this.components[0]=(i*R-c*F+a*C)*E,this.components[1]=(s*F-e*R-n*C)*E,this.components[2]=(r*w-p*g+x*d)*E,this.components[3]=(v*g-b*w-l*d)*E,this.components[4]=(c*z-o*R-a*S)*E,this.components[5]=(t*R-s*z+n*S)*E,this.components[6]=(p*T-f*w-x*M)*E,this.components[7]=(h*w-v*T+l*M)*E,this.components[8]=(o*F-i*z+a*y)*E,this.components[9]=(e*z-t*F-n*y)*E,this.components[10]=(f*g-r*T+x*B)*E,this.components[11]=(b*T-h*g-l*B)*E,this.components[12]=(i*S-o*C-c*y)*E,this.components[13]=(t*C-e*S+s*y)*E,this.components[14]=(r*M-f*d-p*B)*E,this.components[15]=(h*d-b*M+v*B)*E,this}transpose(){const t=this.components[1],e=this.components[2],s=this.components[3],n=this.components[6],o=this.components[7],i=this.components[11];return this.components[1]=this.components[4],this.components[2]=this.components[8],this.components[3]=this.components[12],this.components[4]=t,this.components[6]=this.components[9],this.components[7]=this.components[13],this.components[8]=e,this.components[9]=n,this.components[11]=this.components[14],this.components[12]=s,this.components[13]=o,this.components[14]=i,this}}class N extends A{buffer;device;constructor(t,e,s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST){super(),this.device=t,this.buffer=t.createBuffer({label:e,usage:s,size:64}),this.device=t}writeBuffer(){this.device.queue.writeBuffer(this.buffer,0,this.components.buffer)}}function W(u){return`/Galton-Cubed/${u}`}class X{buffer;dataview;littleEndian;offset;constructor(t,e=!0,s=0){this.buffer=new ArrayBuffer(t),this.dataview=new DataView(this.buffer),this.littleEndian=e,this.offset=s}writeUint8(t){this.dataview.setUint8(this.offset,t),this.offset+=1}writeUint32(t){this.dataview.setUint32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat32(t){this.dataview.setFloat32(this.offset,t,this.littleEndian),this.offset+=4}writeVec3f(t){this.writeFloat32(t.x),this.writeFloat32(t.y),this.writeFloat32(t.z)}writeMat3x3f(t){for(let e=0;e<9;e++)this.writeFloat32(t.components[e]),e%3===2&&this.pad(4)}writeMat4x4f(t){for(let e=0;e<16;e++)this.writeFloat32(t.components[e])}pad(t){this.offset+=t}}class m{components;constructor(t=0,e=0,s=0){this.components=new Float32Array([t,e,s])}static cross(t,e){const s=t.components[0],n=t.components[1],o=t.components[2],i=e.components[0],c=e.components[1],a=e.components[2];return new m(n*a-o*c,o*i-s*a,s*c-n*i)}static add(t,e){return new m(t.components[0]+e.components[0],t.components[1]+e.components[1],t.components[2]+e.components[2])}add(t){return this.components[0]+=t.components[0],this.components[1]+=t.components[1],this.components[2]+=t.components[2],this}static subtract(t,e){return new m(t.components[0]-e.components[0],t.components[1]-e.components[1],t.components[2]-e.components[2])}static scale(t,e){return new m(t.components[0]*e,t.components[1]*e,t.components[2]*e)}scale(t){return this.components[0]*=t,this.components[1]*=t,this.components[2]*=t,this}normalise(){const t=this.magnitude;if(t<1e-8)return console.error("Magnitude of vector too close to 0 to normalise"),this;const e=1/t;return this.components[0]*=e,this.components[1]*=e,this.components[2]*=e,this}get magnitude(){return Math.hypot(this.components[0],this.components[1],this.components[2])}get x(){return this.components[0]}get y(){return this.components[1]}get z(){return this.components[2]}set x(t){this.components[0]=t}set y(t){this.components[1]=t}set z(t){this.components[2]=t}}class j{vertexBuffer;indexBuffer;vertices;indices;rawVertices;rawIndices;label;constructor(t,e,s=""){this.rawVertices=t,this.rawIndices=e??null,this.label=s}initialise(t){this.vertices=new Float32Array(this.rawVertices.map(e=>[e.position.x,e.position.y,e.position.z,e.normal.x,e.normal.y,e.normal.z]).flat()),this.rawIndices!==null?(this.indices=new(this.indexFormat==="uint16"?Uint16Array:Uint32Array)(this.rawIndices),this.indexBuffer=t.createBuffer({label:`${this.label} Index Buffer`,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,size:this.indices.byteLength}),t.queue.writeBuffer(this.indexBuffer,0,this.indices.buffer)):(this.indices=null,this.indexBuffer=null),this.vertexBuffer=t.createBuffer({label:`${this.label} Vertex Buffer`,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,size:this.vertices.byteLength}),t.queue.writeBuffer(this.vertexBuffer,0,this.vertices.buffer)}render(t){this.indexBuffer!==null?t.drawIndexed(this.indexCount):t.draw(this.rawVertices.length)}bind(t,e=0){t.setVertexBuffer(e,this.vertexBuffer),this.indexBuffer!==null&&t.setIndexBuffer(this.indexBuffer,this.indexFormat)}get verticeCount(){return this.rawVertices.length}get indexCount(){return this.indices?.length??0}get indexFormat(){return this.vertices.length>65535?"uint32":"uint16"}}class O extends j{constructor(t,e){const s=[],n=[],o=[new m(1,0,0),new m(-1,0,0),new m(0,1,0),new m(0,-1,0),new m(0,0,1),new m(0,0,-1)];for(let i=0;i<o.length;i++){const c=o[i],a=O.createCubeFace(c,i*t*t,t,e);s.push(...a.vertices),n.push(...a.indices)}super(s,n)}static createCubeFace(t,e,s,n){const o=[],i=[],c=new m(t.y,t.z,t.x).scale(2*n),a=m.cross(t,c),h=m.subtract(m.scale(t,.5*n),m.add(c,a).scale(.5)),b=m.scale(c,1/s),v=m.scale(a,1/s);for(let l=0;l<s;l++)for(let f=0;f<s;f++){const r=m.add(h,m.scale(b,l)).add(m.scale(v,f)).normalise();r.x*=Math.sqrt(1-.5*r.y*r.y-.5*r.z*r.z+r.y*r.y*r.z*r.z/3),r.y*=Math.sqrt(1-.5*r.x*r.x-.5*r.z*r.z+r.x*r.x*r.z*r.z/3),r.z*=Math.sqrt(1-.5*r.y*r.y-.5*r.x*r.x+r.y*r.y*r.x*r.x/3),r.normalise();const p=m.scale(r,n);if(o.push({position:p,normal:r}),l!==s-1&&f!==s-1){const x=e+l+f*s;i.push(x,x+1,x+s+1,x,x+s+1,x+s)}}return{vertices:o,indices:i}}}class Z{sceneBuffer;mesh;objects;initialised;device;maxObjects;constructor(t){this.initialised=!1,this.maxObjects=t,this.objects=[],this.mesh=new O(30,2)}initialise(t){this.initialised||(this.device=t,this.mesh.initialise(t),this.sceneBuffer=t.createBuffer({label:"Ball Scene Buffer",size:this.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.initialised=!0)}update(){if(!this.initialised)return;const t=new X(this.byteLength);t.writeFloat32(this.objects.length),t.pad(12);for(const e of this.objects){const s=e.calculateModelMatrix(),n=e.calculateNormalMatrix(s);t.writeMat4x4f(s),t.writeMat3x3f(n)}this.device.queue.writeBuffer(this.sceneBuffer,0,t.buffer)}get byteLength(){return 16+this.maxObjects*25*4}}const $=Math.PI/180;function I(u){return u*$}const H=180/Math.PI;function G(u){return u*H}class J{position;lookAt;aspectRatio;near;far;fovRadians;constructor(t={}){this.position=t.position??new m,this.lookAt=t.lookAt??new m(0,0,-1),this.aspectRatio=t.aspectRatio??16/9,this.near=t.near??.1,this.far=t.far??1e3,this.fovRadians=I(t.fovDegrees??60)}get fovDegrees(){return G(this.fovRadians)}set fovDegrees(t){this.fovRadians=I(t)}getPerspectiveMatrix(){return A.perspective(this.fovRadians,this.aspectRatio,this.near,this.far)}getViewMatrix(){const t=m.subtract(this.lookAt,this.position).normalise(),e=new m(0,1,0);return A.lookAt(this.position,m.add(this.position,t),e)}getPerspectiveViewMatrix(){return A.multiplyMatrices(this.getPerspectiveMatrix(),this.getViewMatrix())}}class U{shader;constructor(t,e,s){this.shader=t.createShaderModule({label:s,code:e})}static async fetch(t,e,s,n=o=>o){const o=await(await fetch(e)).text(),i=await U.preprocess(e,o);return new U(t,n(i),s)}static async preprocess(t,e){return U.resolveImports(t,e)}static async resolveImports(t,e,s=[]){const n=/#!import.*\s/g,o=t.split("/"),i=o.slice(0,o.length-1).join("/")+"/",c=e.match(n)?.map(h=>h.replaceAll(/(#!import)|\s/g,"")).filter(h=>!s.includes(h)).map(h=>i+h+".wgsl")??[];return((await Promise.all(c.map(async h=>{const b=await fetch(h);if(!b.ok)return"";const v=await b.text();return U.resolveImports(h,v,s)}))).join("")+e).replaceAll(n,"")}}class L{canvas;camera;settings;ballScene;device;ctx;canvasFormat;gpuTimer;initialised;renderBindGroup;renderPipeline;depthTexture;perspectiveViewMatrix;constructor(t,e,s){const n=t.getContext("webgpu");if(n===null)throw new Error("Could not create WebGPU Canvas Context");this.settings={timing:e.timing},this.canvas=t,this.device=s,this.ctx=n,this.canvasFormat="rgba8unorm",this.camera=new J(e.cameraOptions),this.ballScene=new Z(100),this.perspectiveViewMatrix=new N(s,"Perspective View Matrix"),this.gpuTimer=new D(this.device,o=>{const i=o/1e3,c=o/1e6,a=o/1e9,h=c>1,b=(h?c:i).toFixed(2),v=h?"ms":"Î¼s";if(this.settings.timing?.frameTimeElement!==void 0&&(this.settings.timing.frameTimeElement.textContent=b+v),this.settings.timing?.fpsElement!==void 0){const l=1/a;this.settings.timing.fpsElement.textContent=l.toFixed(2)}}),this.gpuTimer.canTimestamp||(this.settings.timing?.frameTimeElement!==void 0&&(this.settings.timing.frameTimeElement.textContent="[Not supported by browser]"),this.settings.timing?.fpsElement!==void 0&&(this.settings.timing.fpsElement.textContent="[Not supported by browser]")),this.initialised=!1}async initialise(){this.initialised||(this.ballScene.initialise(this.device),await this.initialiseRendering(),new ResizeObserver(t=>{const e=t[0],s=e.devicePixelContentBoxSize[0].inlineSize,n=e.devicePixelContentBoxSize[0].blockSize;this.canvas.width=s,this.canvas.height=n,this.camera.aspectRatio=s/n,this.depthTexture?.destroy(),this.depthTexture=this.createDepthTexture(),this.gpuTimer.reset(),this.render()}).observe(this.canvas),this.initialised=!0)}createDepthTexture(){return this.device.createTexture({label:"Renderer Depth Texture",size:[this.canvas.width,this.canvas.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT})}async initialiseRendering(){this.ctx.configure({device:this.device,format:this.canvasFormat});const t=await U.fetch(this.device,W("shaders/render.wgsl"));this.depthTexture=this.createDepthTexture();const e=this.device.createBindGroupLayout({label:"Cube Bind Group Layout",entries:[{binding:0,buffer:{type:"uniform"},visibility:GPUShaderStage.VERTEX},{binding:1,buffer:{type:"read-only-storage"},visibility:GPUShaderStage.VERTEX}]});this.renderBindGroup=this.device.createBindGroup({label:"Render Bing Group",layout:e,entries:[{binding:0,resource:{buffer:this.perspectiveViewMatrix.buffer}},{binding:1,resource:{buffer:this.ballScene.sceneBuffer}}]});const s=this.device.createPipelineLayout({label:"Renderer Render Pipeline Layout",bindGroupLayouts:[e]});this.renderPipeline=this.device.createRenderPipeline({label:"Renderer Render Pipeline",layout:s,vertex:{module:t.shader,buffers:[{arrayStride:24,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x3",offset:12}]}]},fragment:{module:t.shader,targets:[{format:this.canvasFormat}]},primitive:{},depthStencil:{format:"depth24plus",depthCompare:"less",depthWriteEnabled:!0}})}render(){this.perspectiveViewMatrix.copyFrom(this.camera.getPerspectiveViewMatrix()),this.perspectiveViewMatrix.writeBuffer(),this.renderToCanvas()}renderToCanvas(){const t=this.device.createCommandEncoder(),e=this.gpuTimer.beginRenderPass(t,{colorAttachments:[{view:this.ctx.getCurrentTexture().createView(),loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTexture.createView(),depthLoadOp:"clear",depthStoreOp:"store",depthClearValue:1}});this.ballScene.mesh.bind(e),e.setBindGroup(0,this.renderBindGroup),e.setPipeline(this.renderPipeline),e.drawIndexed(this.ballScene.mesh.indexCount,this.ballScene.objects.length),e.end(),this.device.queue.submit([t.finish()])}static async create(t,e={}){if(!("gpu"in navigator))throw new Error("WebGPU not supported");const s=await navigator.gpu.requestAdapter();if(s===null)throw new Error("Could not find suitable GPU Adapter. Maybe your browser doesn't support WebGPU?");const n=await s.requestDevice({requiredFeatures:L.requestFeatures(s,"timestamp-query")});if(n===null)throw new Error("Could not find suitable GPU Device. Maybe your browser doesn't support WebGPU?");return new L(t,e,n)}static requestFeatures(t,...e){return e.filter(s=>{const n=t.features.has(s);return n||console.warn(`GPU Feature ${s} not supported`),n})}}class K{settings;callbacks=[];frameID;lastFrameTime;totalTime;constructor(t={}){this.frameID=null,this.lastFrameTime=0,this.totalTime=0,this.callbacks=[],this.settings={wormholeThreshold:t.wormholeThreshold??500}}start(){this.running||(this.totalTime=0,this.lastFrameTime=-1,this.frameID=requestAnimationFrame(this.tick.bind(this)))}stop(){this.running&&(cancelAnimationFrame(this.frameID),this.frameID=null)}toggle(){this.running?this.stop():this.start()}addCallback(t){this.callbacks.push(t)}tick(t){this.lastFrameTime<0&&(this.lastFrameTime=t);const e=t-this.lastFrameTime,s=this.totalTime+e;if(e<this.settings.wormholeThreshold){const n={deltaTime:e,totalTime:s};for(const o of this.callbacks)o(n);this.totalTime=s}this.lastFrameTime=t,this.frameID=requestAnimationFrame(this.tick.bind(this))}get running(){return this.frameID!==null}}function Q(u){_()}function _(){const u=document.getElementById("chevron"),t=document.getElementById("content");if(u===null)throw new Error("Could not find chevron element");if(t===null)throw new Error("Could not find info panel");u.addEventListener("click",()=>{u.classList.toggle("collapsed"),t.classList.toggle("collapsed")})}class q{components;constructor(){this.components=new Float32Array(9),this.components[0]=1,this.components[4]=1,this.components[8]=1}static fromMatrix4(t){const e=new q;return e.components[0]=t.components[0],e.components[1]=t.components[1],e.components[2]=t.components[2],e.components[3]=t.components[4],e.components[4]=t.components[5],e.components[5]=t.components[6],e.components[6]=t.components[8],e.components[7]=t.components[9],e.components[8]=t.components[10],e}transpose(){const t=this.components[1],e=this.components[2],s=this.components[5];return this.components[1]=this.components[3],this.components[2]=this.components[6],this.components[3]=t,this.components[5]=this.components[7],this.components[6]=e,this.components[7]=s,this}}function tt(u,t,e){return Math.max(Math.min(u,e),t)}class P{components;constructor(t=0,e=0,s=0,n=1){this.components=new Float32Array([t,e,s,n])}getEulerAngles(){this.normalise();const t=this.toRotationMatrix();let e,s;const n=Math.asin(-tt(t.components[2],-1,1));return Math.abs(t.components[2])<.9999999?(e=Math.atan2(t.components[6],t.components[10]),s=Math.atan2(t.components[1],t.components[0])):(e=0,s=Math.atan2(-t.components[4],t.components[5])),[G(e),G(n),G(s)]}get eulerX(){return this.getEulerAngles()[0]}get eulerY(){return this.getEulerAngles()[1]}get eulerZ(){return this.getEulerAngles()[2]}set eulerX(t){const e=this.getEulerAngles();this.multiply(P.fromEulerAngles(t,e[1],e[2]))}set eulerY(t){const e=this.getEulerAngles();this.copyFrom(P.fromEulerAngles(e[0],t,e[2]))}set eulerZ(t){const e=this.getEulerAngles();this.copyFrom(P.fromEulerAngles(e[0],e[1],t))}rotateX(t){this.multiply(P.fromEulerAngles(t,0,0))}rotateY(t){this.multiply(P.fromEulerAngles(0,t,0))}rotateZ(t){this.multiply(P.fromEulerAngles(0,0,t))}multiply(t){const e=this.x,s=this.y,n=this.z,o=this.w,i=t.x,c=t.y,a=t.z,h=t.w;return this.x=o*i+e*h+s*a-n*c,this.y=o*c-e*a+s*h+n*i,this.z=o*a+e*c-s*i+n*h,this.w=o*h-e*i-s*c-n*a,this}toRotationMatrix(){const t=this.x,e=this.y,s=this.z,n=this.w,o=new A;return o.components[0]=1-2*(e*e+s*s),o.components[1]=2*(t*e+s*n),o.components[2]=2*(t*s-e*n),o.components[4]=2*(t*e-s*n),o.components[5]=1-2*(t*t+s*s),o.components[6]=2*(n*t+e*s),o.components[8]=2*(e*n+t*s),o.components[9]=2*(e*s-t*n),o.components[10]=1-2*(t*t+e*e),o}copyFrom(t){return this.components[0]=t.components[0],this.components[1]=t.components[1],this.components[2]=t.components[2],this.components[3]=t.components[3],this}static fromEulerAngles(t,e,s){t=I(t),e=I(e),s=I(s);const n=Math.sin(t/2),o=Math.cos(t/2),i=Math.sin(e/2),c=Math.cos(e/2),a=Math.sin(s/2),h=Math.cos(s/2);return new P(n*c*h-o*i*a,o*i*h+n*c*a,o*c*a-n*i*h,o*c*h+n*i*a)}normalise(){const t=this.magnitude;if(t<1e-8)return console.error("Magnitude of vector too close to 0 to normalise"),this;const e=1/t;return this.components[0]*=e,this.components[1]*=e,this.components[2]*=e,this.components[3]*=e,this}get magnitude(){return Math.hypot(this.components[0],this.components[1],this.components[2],this.components[3])}get x(){return this.components[0]}get y(){return this.components[1]}get z(){return this.components[2]}get w(){return this.components[3]}set x(t){this.components[0]=t}set y(t){this.components[1]=t}set z(t){this.components[2]=t}set w(t){this.components[3]=t}}class k{position;rotation;scale;constructor(t={}){this.position=t.position??new m,this.rotation=t.rotation??new P,this.scale=t.scale??new m(1,1,1)}calculateModelMatrix(){const t=this.rotation.toRotationMatrix();return t.components[0]*=this.scale.x,t.components[1]*=this.scale.x,t.components[2]*=this.scale.x,t.components[4]*=this.scale.y,t.components[5]*=this.scale.y,t.components[6]*=this.scale.y,t.components[8]*=this.scale.z,t.components[9]*=this.scale.z,t.components[10]*=this.scale.z,t.components[12]=this.position.x,t.components[13]=this.position.y,t.components[14]=this.position.z,t}calculateNormalMatrix(t){return q.fromMatrix4(new A().copyFrom(t).invert()).transpose()}}async function et(){const u=document.getElementById("main"),t=document.getElementById("frameTime"),e=document.getElementById("fps"),s=await L.create(u,{timing:{frameTimeElement:t,fpsElement:e}});await s.initialise();const n=new k({position:new m(-2.5,-.5,-.5),rotation:P.fromEulerAngles(0,0,0),scale:new m(1.2,1.2,1.2)}),o=new k({position:new m(2.5,-.5,-.5),rotation:P.fromEulerAngles(0,0,0),scale:new m(.5,.5,.5)});s.ballScene.objects.push(n,o),s.camera.position=new m(3,3,3),s.camera.fovDegrees=60,s.camera.lookAt=new m(0,0,0),Q();const i=new K;i.addCallback(()=>{n.rotation.rotateX(.5),n.rotation.rotateY(1),n.rotation.rotateZ(2),s.ballScene.update(),s.render()}),i.start(),u.addEventListener("click",()=>{u.requestPointerLock()})}et().catch(u=>{const t=u instanceof Error?u.message:JSON.stringify(u),e=document.getElementById("message");e.classList.add("error"),e.textContent=t;const s=document.getElementById("chevron"),n=document.getElementById("content");s?.classList.add("collapsed"),n?.classList.add("collapsed"),console.trace(),console.error(t)});
